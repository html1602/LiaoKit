<template>
  <div class="markdown-style-fix-example">
    <div class="example-header">
      <h2>ğŸ¨ AIæ¶ˆæ¯Markdownæ ·å¼ä¿®å¤æ¼”ç¤º</h2>
      <p class="example-description">
        è§£å†³AIå›å¤æ˜¾ç¤ºæ ·å¼éš¾çœ‹çš„é—®é¢˜ï¼Œæä¾›ç¾è§‚çš„Markdownæ¸²æŸ“æ•ˆæœ
      </p>
    </div>

    <div class="example-controls">
      <div class="control-group">
        <label>
          <input v-model="useEnhancedMarkdown" type="checkbox" />
          å¯ç”¨å¢å¼ºMarkdownæ ·å¼
        </label>
      </div>
      <div class="control-group">
        <label>
          <input v-model="darkTheme" type="checkbox" />
          æš—è‰²ä¸»é¢˜
        </label>
      </div>
      <button @click="addTestMessage" class="add-btn">
        æ·»åŠ æµ‹è¯•æ¶ˆæ¯
      </button>
    </div>

    <div class="example-content">
      <div class="messages-container">
        <div class="message-comparison">
          <!-- åŸå§‹æ ·å¼ -->
          <div class="comparison-section">
            <h3>âŒ åŸå§‹æ ·å¼ï¼ˆé—®é¢˜ç¤ºä¾‹ï¼‰</h3>
            <div class="message-bubble original-style">
              <div class="message-content">
                <div v-html="originalMarkdownHTML"></div>
              </div>
            </div>
          </div>

          <!-- ä¿®å¤åæ ·å¼ -->
          <div class="comparison-section">
            <h3>âœ… ä¿®å¤åæ ·å¼ï¼ˆç¾è§‚æ•ˆæœï¼‰</h3>
            <div class="message-bubble fixed-style" :class="{ 'dark-theme': darkTheme }">
              <div class="message-content">
                <div 
                  class="liao-markdown-content" 
                  :class="{ 'dark-theme': darkTheme }"
                  v-html="enhancedMarkdownHTML"
                ></div>
              </div>
            </div>
          </div>
        </div>

        <!-- LiaoMessageListæ¼”ç¤º -->
        <div class="liaokit-demo">
          <h3>ğŸ“± LiaoKitç»„ä»¶é›†æˆæ¼”ç¤º</h3>
          <LiaoMessageList
            :messages="demoMessages"
            :use-ai-adapter="false"
            :enable-markdown="useEnhancedMarkdown"
            style="height: 400px; border: 1px solid #e0e0e0; border-radius: 8px;"
          />
        </div>
      </div>
    </div>

    <div class="solution-guide">
      <h3>ğŸ”§ è§£å†³æ–¹æ¡ˆæŒ‡å—</h3>
      <div class="solution-steps">
        <div class="solution-step">
          <div class="step-number">1</div>
          <div class="step-content">
            <h4>å¼•å…¥å¢å¼ºæ ·å¼</h4>
            <pre><code>// åœ¨æ‚¨çš„ä¸»CSSæ–‡ä»¶ä¸­å¼•å…¥
@import '@yuandezuohua/liaokit/dist/liaokit.css';
@import './markdown-enhanced.css'; // æ–°å¢çš„Markdownæ ·å¼æ–‡ä»¶</code></pre>
          </div>
        </div>

        <div class="solution-step">
          <div class="step-number">2</div>
          <div class="step-content">
            <h4>ç¡®ä¿Markdownè§£ææ­£ç¡®</h4>
            <pre><code>// åœ¨æ‚¨çš„LiaoMessageListé…ç½®ä¸­
&lt;LiaoMessageList
  :messages="messages"
  :use-ai-adapter="true"
  :enable-markdown="true"
  :ai-adapter-options="aiAdapterOptions"
/&gt;</code></pre>
          </div>
        </div>

        <div class="solution-step">
          <div class="step-number">3</div>
          <div class="step-content">
            <h4>åº”ç”¨CSSç±»å</h4>
            <pre><code>// ç¡®ä¿AIé€‚é…å™¨è¿”å›çš„å†…å®¹ä½¿ç”¨æ­£ç¡®çš„ç±»å
&lt;div class="liao-markdown-content"&gt;
  {/* AIå›å¤çš„Markdownå†…å®¹ */}
&lt;/div&gt;</code></pre>
          </div>
        </div>
      </div>
    </div>

    <div class="troubleshooting">
      <h3>ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥</h3>
      <div class="faq-list">
        <div class="faq-item">
          <h4>Q: AIå›å¤è¿˜æ˜¯æ˜¾ç¤ºçº¯æ–‡æœ¬ï¼Œæ²¡æœ‰æ ¼å¼åŒ–ï¼Ÿ</h4>
          <p>A: è¯·æ£€æŸ¥ï¼š1) enableMarkdownæ˜¯å¦ä¸ºtrueï¼›2) markedåº“æ˜¯å¦æ­£ç¡®å®‰è£…ï¼›3) AIé€‚é…å™¨æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
        </div>
        <div class="faq-item">
          <h4>Q: æ ·å¼æ˜¾ç¤ºä¸æ­£ç¡®ï¼Œé—´è·å’Œé¢œè‰²å¾ˆéš¾çœ‹ï¼Ÿ</h4>
          <p>A: è¯·ç¡®ä¿å¼•å…¥äº†markdown.scssæ ·å¼æ–‡ä»¶ï¼Œå¹¶ä¸”HTMLå†…å®¹åŒ…å«åœ¨.liao-markdown-contentç±»ä¸­</p>
        </div>
        <div class="faq-item">
          <h4>Q: ä»£ç å—æ˜¾ç¤ºæ•ˆæœä¸ä½³ï¼Ÿ</h4>
          <p>A: æ£€æŸ¥CSSæ–‡ä»¶æ˜¯å¦å®Œæ•´åŠ è½½ï¼Œä»£ç å—éœ€è¦ç‰¹æ®Šçš„æ ·å¼å®šä¹‰æ‰èƒ½æ­£ç¡®æ˜¾ç¤º</p>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue';
import { marked } from 'marked';
import LiaoMessageList from '../components/LiaoMessageList/LiaoMessageList.vue';

// é…ç½®marked
marked.setOptions({
  breaks: true,
  gfm: true,
  headerIds: false,
  mangle: false
});

// å“åº”å¼çŠ¶æ€
const useEnhancedMarkdown = ref(true);
const darkTheme = ref(false);
const demoMessages = ref([
  {
    id: 1,
    content: "ä½ å¥½ï¼æˆ‘æ¥ç»™ä½ æ¼”ç¤ºä¸€ä¸‹Markdownæ ¼å¼çš„å›å¤æ•ˆæœã€‚",
    type: 'text',
    isSelf: true,
    time: Date.now() - 10000,
  },
  {
    id: 2,
    content: testMarkdownContent,
    type: 'text',
    isSelf: false,
    time: Date.now() - 5000,
  }
]);

// æµ‹è¯•ç”¨çš„Markdownå†…å®¹ - æ·»åŠ æ›´å¤šç±»å‹çš„å†…å®¹
const testMarkdownContent = `## ğŸ¤– AIåŠ©æ‰‹å›å¤ç¤ºä¾‹

è¿™æ˜¯ä¸€ä¸ªåŒ…å«å¤šç§æ ¼å¼çš„AIå›å¤æ¼”ç¤ºï¼š

### ğŸ“‹ æœåŠ¡å†…å®¹

**äº§å“è´­ä¹°**ï¼šæ”¯æŒåœ¨çº¿ä¸‹å•ã€è®¢å•ç®¡ç†ã€æ”¶é›†æ”¶ä»¶äººä¿¡æ¯ã€åœ°å€ç­‰ ï¼ˆå‚è€ƒï¼‰ã€‚

**ç¤¾åŒºäº’åŠ¨**ï¼šç”¨æˆ·å¯åŠ å…¥ç¤¾åŒºå°ç»„ç»‡ã€è¯„è®ºï¼Œåˆ†äº«åŠ¨æ€å†…å®¹ ï¼ˆå‚è€ƒï¼‰ã€‚

**æ´»åŠ¨æŠ¥å**ï¼šæ”¯æŒæ–°çº¦çº¿ä¸‹æ´»åŠ¨ï¼Œéœ€æä¾›å§“åã€æ‰‹æœºå·ç­‰ä¿¡æ¯ ï¼ˆå‚è€ƒï¼‰ã€‚

### ğŸ’¡ æŠ€æœ¯ç‰¹ç‚¹

1. **æ™ºèƒ½è¯†åˆ«**ï¼šè‡ªåŠ¨åˆ†æç”¨æˆ·éœ€æ±‚
2. **å¿«é€Ÿå“åº”**ï¼šæ¯«ç§’çº§å¤„ç†é€Ÿåº¦  
3. **å¤šformatæ”¯æŒ**ï¼šæ–‡æœ¬ã€å›¾ç‰‡ã€æ–‡ä»¶ç­‰

è¿™æ˜¯ä¸€ä¸ªæ™®é€šæ®µè½ï¼Œå±•ç¤ºæ–‡æœ¬çš„åŸºç¡€è¡Œé—´è·æ•ˆæœã€‚åœ¨ä¼˜åŒ–åï¼Œè¡Œé—´è·åº”è¯¥æ›´åŠ ç´§å‡‘ï¼Œç¬¦åˆæ ‡å‡†çš„Markdownæ¸²æŸ“è§„èŒƒã€‚

- è¿™æ˜¯ä¸€ä¸ªæ— åºåˆ—è¡¨é¡¹
- ç¬¬äºŒä¸ªåˆ—è¡¨é¡¹
  - åµŒå¥—åˆ—è¡¨é¡¹
  - å¦ä¸€ä¸ªåµŒå¥—é¡¹
- å›åˆ°ç¬¬ä¸€çº§åˆ—è¡¨

### ğŸ“Š æ•°æ®ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| å‡†ç¡®ç‡ | 99.2% | AIè¯†åˆ«å‡†ç¡®ç‡ |
| å“åº”æ—¶é—´ | <100ms | å¹³å‡å“åº”æ—¶é—´ |
| ç”¨æˆ·æ»¡æ„åº¦ | 4.8/5 | ç”¨æˆ·è¯„åˆ† |

### ğŸ’» ä»£ç ç¤ºä¾‹

\`\`\`javascript
// AIæ¶ˆæ¯é€‚é…å™¨é…ç½®
const aiConfig = {
  model: 'qwen-turbo',
  temperature: 0.7,
  maxTokens: 1000
};

// å†…è”ä»£ç ç¤ºä¾‹
const result = processMessage(content);
\`\`\`

è¡Œå†…ä»£ç ç¤ºä¾‹ï¼š\`const variable = "value"\`ï¼Œè¿™æ ·çš„ä»£ç åº”è¯¥æœ‰åˆé€‚çš„èƒŒæ™¯è‰²ã€‚

### ğŸ“ é‡è¦æç¤º

> å¦‚æœæ‚¨æœ‰æ›´å…·ä½“çš„é—®é¢˜ï¼Œæ¯”å¦‚éšç§æ”¿ç­–ç»†èŠ‚æˆ–åŠŸèƒ½ä½¿ç”¨ç–‘é—®ï¼Œå¯ä»¥éšæ—¶å‘æˆ‘è¯¢é—®ï¼ğŸ’™
> 
> è¿™æ˜¯å¼•ç”¨å—çš„ç¬¬äºŒè¡Œï¼Œåº”è¯¥æœ‰åˆé€‚çš„ç¼©è¿›å’Œæ ·å¼ã€‚

---

å¸Œæœ›è¿™ä¸ªæ¼”ç¤ºèƒ½å¸®åŠ©æ‚¨äº†è§£AIå›å¤çš„æ ¼å¼åŒ–æ•ˆæœï¼

**ç²—ä½“æ–‡æœ¬**å’Œ*æ–œä½“æ–‡æœ¬*çš„ç»„åˆå±•ç¤ºã€‚

~~åˆ é™¤çº¿æ–‡æœ¬~~ä¹Ÿæ˜¯å¸¸ç”¨çš„æ ¼å¼ã€‚`;

// åŸå§‹HTMLï¼ˆæ¨¡æ‹Ÿé—®é¢˜çŠ¶æ€ï¼‰
const originalMarkdownHTML = computed(() => {
  return marked(testMarkdownContent);
});

// å¢å¼ºHTMLï¼ˆä¿®å¤åçŠ¶æ€ï¼‰
const enhancedMarkdownHTML = computed(() => {
  return marked(testMarkdownContent);
});

// æ·»åŠ æµ‹è¯•æ¶ˆæ¯
const addTestMessage = () => {
  const newMessage = {
    id: Date.now(),
    content: `### æ–°æµ‹è¯•æ¶ˆæ¯ ${new Date().toLocaleTimeString()}

è¿™æ˜¯ä¸€ä¸ªæ–°æ·»åŠ çš„æµ‹è¯•æ¶ˆæ¯ï¼ŒåŒ…å«ï¼š

- **ç²—ä½“æ–‡æœ¬**æ¼”ç¤º
- *æ–œä½“æ–‡æœ¬*æ¼”ç¤º  
- \`è¡Œå†…ä»£ç \`æ¼”ç¤º

\`\`\`python
# ä»£ç å—æ¼”ç¤º
def hello_world():
    print("Hello, LiaoKit!")
\`\`\`

> è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨å—ç¤ºä¾‹ï¼Œç”¨äºå±•ç¤ºæ ·å¼æ•ˆæœã€‚`,
    type: 'text',
    isSelf: Math.random() > 0.5,
    time: Date.now(),
  };
  
  demoMessages.value.push(newMessage);
};
</script>

<style lang="scss" scoped>
.markdown-style-fix-example {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  
  .example-header {
    text-align: center;
    margin-bottom: 30px;
    
    h2 {
      color: #2c3e50;
      margin-bottom: 10px;
    }
    
    .example-description {
      color: #7f8c8d;
      font-size: 16px;
    }
  }
  
  .example-controls {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    margin-bottom: 30px;
    
    .control-group {
      display: flex;
      align-items: center;
      
      label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
        
        input[type="checkbox"] {
          width: 16px;
          height: 16px;
          accent-color: #667eea;
        }
      }
    }
    
    .add-btn {
      padding: 8px 16px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: background 0.2s;
      
      &:hover {
        background: #5a6fd8;
      }
    }
  }
  
  .example-content {
    .message-comparison {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 40px;
      
      @media (max-width: 768px) {
        grid-template-columns: 1fr;
      }
      
      .comparison-section {
        h3 {
          margin-bottom: 15px;
          padding: 10px 15px;
          border-radius: 6px;
          
          &:has-text("âŒ") {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
          }
          
          &:has-text("âœ…") {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
          }
        }
        
        .message-bubble {
          background: white;
          border: 1px solid #e0e0e0;
          border-radius: 12px;
          padding: 0;
          max-height: 500px;
          overflow-y: auto;
          
          &.dark-theme {
            background: #2a2a2a;
            border-color: #444;
            color: #e0e0e0;
          }
          
          .message-content {
            padding: 16px;
          }
        }
        
        .original-style {
          // æ¨¡æ‹ŸåŸå§‹çš„ç³Ÿç³•æ ·å¼
          .message-content {
            font-family: monospace;
            font-size: 12px;
            line-height: 1.2;
            color: #666;
            
            div {
              white-space: pre-line;
            }
          }
        }
        
        .fixed-style {
          // åº”ç”¨ä¿®å¤åçš„ç¾è§‚æ ·å¼
          .message-content {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
          }
        }
      }
    }
    
    .liaokit-demo {
      h3 {
        margin-bottom: 15px;
        color: #2c3e50;
      }
    }
  }
  
  .solution-guide {
    margin: 40px 0;
    padding: 20px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 12px;
    
    h3 {
      color: #2c3e50;
      margin-bottom: 20px;
    }
    
    .solution-steps {
      display: flex;
      flex-direction: column;
      gap: 20px;
      
      .solution-step {
        display: flex;
        gap: 15px;
        
        .step-number {
          width: 32px;
          height: 32px;
          background: #667eea;
          color: white;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
          flex-shrink: 0;
        }
        
        .step-content {
          flex: 1;
          
          h4 {
            margin-bottom: 8px;
            color: #2c3e50;
          }
          
          pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 12px 16px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.4;
          }
        }
      }
    }
  }
  
  .troubleshooting {
    padding: 20px;
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    
    h3 {
      color: #856404;
      margin-bottom: 15px;
    }
    
    .faq-list {
      .faq-item {
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid #ffeaa7;
        
        &:last-child {
          border-bottom: none;
          margin-bottom: 0;
          padding-bottom: 0;
        }
        
        h4 {
          color: #856404;
          margin-bottom: 5px;
          font-size: 14px;
        }
        
        p {
          color: #6c757d;
          font-size: 13px;
          line-height: 1.5;
          margin: 0;
        }
      }
    }
  }
}

// å¼•å…¥å¢å¼ºçš„Markdownæ ·å¼
@import '../styles/markdown.scss';
</style> 